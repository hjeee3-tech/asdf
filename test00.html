<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프라코 품질관리 어드민 대시보드 (Metronic Style)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        metronic: {
                            bg: '#f5f8fa',
                            sidebar: '#1e1e2d',
                            sidebarActive: '#1b1b29',
                            primary: '#009ef7',
                            primaryLight: '#f1faff',
                            textMuted: '#a1a5b7',
                            borderDashed: '#eff2f5'
                        }
                    },
                    boxShadow: {
                        'metronic': '0 0 20px 0 rgba(76, 87, 125, 0.02)',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .chart-container { position: relative; height: 300px; width: 100%; }
        /* Chart tooltip customization */
        .chartjs-tooltip { background: rgba(0, 0, 0, 0.8) !important; border-radius: 8px; }
        /* Scrollbar customization for webkit */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #E4E6EF; border-radius: 4px; }
    </style>
</head>
<body class="text-gray-800 bg-metronic-bg">

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar (Metronic Dark Style) -->
        <aside class="w-64 bg-metronic-sidebar text-[#9899ac] flex flex-col hidden md:flex font-medium">
            <div class="h-20 flex items-center px-8 text-2xl font-bold text-white tracking-wider">
                <i data-lucide="shield-check" class="text-metronic-primary mr-3 w-8 h-8"></i> PLAKOR
            </div>
            <nav class="flex-1 px-4 space-y-1 mt-4">
                <a href="#" class="flex items-center gap-3 bg-metronic-sidebarActive text-metronic-primary px-4 py-3 rounded-md transition-colors">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> 대시보드
                </a>
                <a href="#" class="flex items-center gap-3 hover:text-white px-4 py-3 rounded-md transition-colors">
                    <i data-lucide="clipboard-list" class="w-5 h-5"></i> 검수현황
                </a>
                <a href="#" class="flex items-center gap-3 hover:text-white px-4 py-3 rounded-md transition-colors">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i> 불량관리
                </a>
                <a href="#" class="flex items-center gap-3 hover:text-white px-4 py-3 rounded-md transition-colors">
                    <i data-lucide="database" class="w-5 h-5"></i> 마스터 데이터
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-8">
            <!-- Header -->
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">대시보드</h1>
                    <ul class="flex items-center gap-2 text-sm text-metronic-textMuted mt-2 font-medium">
                        <li>Home</li>
                        <li><span class="w-1 h-1 bg-gray-300 rounded-full inline-block"></span></li>
                        <li>품질관리</li>
                        <li><span class="w-1 h-1 bg-gray-300 rounded-full inline-block"></span></li>
                        <li class="text-gray-600">초중종품 지표</li>
                    </ul>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-sm font-medium text-metronic-textMuted">기준일: 2026-02-24</span>
                    <button class="bg-metronic-primary hover:bg-blue-600 text-white px-4 py-2.5 rounded-md text-sm font-semibold shadow-sm flex items-center gap-2 transition-colors">
                        <i data-lucide="calendar" class="w-4 h-4"></i> 기간 설정
                    </button>
                </div>
            </header>

            <!-- Charts Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- 1. 검사 진행 현황 (세로 막대) -->
                <div class="bg-white rounded-xl shadow-metronic border-0">
                    <div class="px-7 py-5 border-b border-dashed border-metronic-borderDashed flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">단계별 검사 현황</h3>
                            <span class="text-xs font-medium text-metronic-textMuted mt-1 block">전체 대비 초/중/종품 처리 볼륨</span>
                        </div>
                    </div>
                    <div class="p-7">
                        <div class="chart-container">
                            <canvas id="inspectionVolumeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 2. 검사 단계별 4M 위반 비율 (도넛 차트 + 중앙 총합) -->
                <div class="bg-white rounded-xl shadow-metronic border-0">
                    <div class="px-7 py-5 border-b border-dashed border-metronic-borderDashed flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">검사 단계별 4M 위반 비율</h3>
                            <span class="text-xs font-medium text-metronic-textMuted mt-1 block">초/중/종품 단계별 위반 건수 비중 및 총 누적 건수</span>
                        </div>
                    </div>
                    <div class="p-7">
                        <div class="chart-container flex items-center justify-center">
                             <canvas id="violationStageDonutChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 3. 협력사 분포 (영남/중부 도넛 차트) -->
                <div class="bg-white rounded-xl shadow-metronic border-0">
                    <div class="px-7 py-5 border-b border-dashed border-metronic-borderDashed flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">권역별 협력사 가동 현황</h3>
                            <span class="text-xs font-medium text-metronic-textMuted mt-1 block">영남권 및 중부권 협력사 참여 현황</span>
                        </div>
                    </div>
                    <div class="p-7">
                        <div class="chart-container">
                            <canvas id="partnerDonutChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 4. 부품별 검사/불량 건수 (그룹 막대 차트) -->
                <div class="bg-white rounded-xl shadow-metronic border-0">
                    <div class="px-7 py-5 border-b border-dashed border-metronic-borderDashed flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">부품별 검사 및 불량 현황</h3>
                            <span class="text-xs font-medium text-metronic-textMuted mt-1 block">내장/외장 부품별 검사 건수 및 불량 발생 건수</span>
                        </div>
                    </div>
                    <div class="p-7">
                        <div class="chart-container">
                            <canvas id="partDefectGroupedChart"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Chart.js 공식 문서 기본 색상 팔레트
        const CHART_COLORS = {
            red: { bg: 'rgba(255, 99, 132, 0.5)', border: 'rgb(255, 99, 132)' },
            blue: { bg: 'rgba(54, 162, 235, 0.5)', border: 'rgb(54, 162, 235)' },
            yellow: { bg: 'rgba(255, 205, 86, 0.5)', border: 'rgb(255, 205, 86)' },
            green: { bg: 'rgba(75, 192, 192, 0.5)', border: 'rgb(75, 192, 192)' },
            purple: { bg: 'rgba(153, 102, 255, 0.5)', border: 'rgb(153, 102, 255)' },
            grey: { bg: 'rgba(201, 203, 207, 0.5)', border: 'rgb(201, 203, 207)' }
        };

        // Chart Global defaults
        Chart.defaults.font.family = "'Pretendard', sans-serif";
        Chart.defaults.color = '#a1a5b7';
        Chart.defaults.plugins.tooltip.padding = 12;
        Chart.defaults.plugins.tooltip.backgroundColor = '#1e1e2d';
        Chart.defaults.plugins.tooltip.titleFont = { size: 13, weight: 'bold' };
        
        const gridOptions = { color: '#eff2f5', drawBorder: false, borderDash: [5, 5] };

        // 1. 단계별 검사 현황 (세로 막대)
        const ctx1 = document.getElementById('inspectionVolumeChart').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['총 검사', '초품 검사', '중품 검사', '종품 검사'],
                datasets: [{
                    label: '검사 건수',
                    data: [1234, 520, 480, 234],
                    backgroundColor: [CHART_COLORS.grey.bg, CHART_COLORS.blue.bg, CHART_COLORS.green.bg, CHART_COLORS.purple.bg],
                    borderColor: [CHART_COLORS.grey.border, CHART_COLORS.blue.border, CHART_COLORS.green.border, CHART_COLORS.purple.border],
                    borderWidth: 1, borderRadius: 4, barPercentage: 0.6
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: gridOptions },
                    x: { grid: { display: false } }
                }
            }
        });

        // Custom Plugin for Donut Chart Center Text (Dynamic Reusable)
        const donutCenterText = {
            id: 'donutCenterText',
            beforeDraw: function(chart) {
                if (chart.config.type !== 'doughnut') return;
                var width = chart.width, height = chart.height, ctx = chart.ctx;
                ctx.restore();
                
                var total = chart.config.data.centerNumber;
                var labelText = chart.config.data.centerLabel;
                
                var fontSize1 = (height / 110).toFixed(2);
                ctx.font = "bold " + fontSize1 + "em Pretendard";
                ctx.textBaseline = "middle";
                ctx.fillStyle = "#3f4254"; 
                var text1 = total, textX1 = Math.round((width - ctx.measureText(text1).width) / 2), textY1 = height / 2 - 10;
                ctx.fillText(text1, textX1, textY1);
                
                var fontSize2 = (height / 250).toFixed(2);
                ctx.font = "600 " + fontSize2 + "em Pretendard";
                ctx.fillStyle = "#a1a5b7"; 
                var text2 = labelText, textX2 = Math.round((width - ctx.measureText(text2).width) / 2), textY2 = height / 2 + 20;
                ctx.fillText(text2, textX2, textY2);
                
                ctx.save();
            }
        };

        // 2. 검사 단계별 4M 위반 비율 (도넛 차트 - 중앙 총합 표시)
        const ctx2 = document.getElementById('violationStageDonutChart').getContext('2d');
        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: ['초품 위반', '중품 위반', '종품 위반'],
                datasets: [{
                    data: [25, 12, 5], // 예시 건수 데이터 (총 42건)
                    // 1번 차트의 초/중/종품 색상과 정확히 동기화하여 인지 부하 감소
                    backgroundColor: [CHART_COLORS.blue.bg, CHART_COLORS.green.bg, CHART_COLORS.purple.bg],
                    borderColor: [CHART_COLORS.blue.border, CHART_COLORS.green.border, CHART_COLORS.purple.border],
                    borderWidth: 1,
                    hoverOffset: 4
                }],
                centerNumber: 42,
                centerLabel: "총 위반건수"
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '75%',
                layout: { padding: 10 },
                plugins: {
                    legend: { 
                        position: 'right', // 공간 활용을 위해 우측 배치
                        labels: { usePointStyle: true, boxWidth: 8, padding: 20 } 
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) { 
                                // 툴팁에 건수와 비율(%)을 동시에 표시
                                let total = context.chart._metasets[context.datasetIndex].total;
                                let value = context.raw;
                                let percentage = Math.round((value / total) * 100);
                                return ' ' + context.label + ': ' + value + '건 (' + percentage + '%)'; 
                            }
                        }
                    }
                }
            },
            plugins: [donutCenterText]
        });

        // 3. 권역별 협력사 분포 (영남권 / 중부권 2분할 도넛 차트)
        const ctx3 = document.getElementById('partnerDonutChart').getContext('2d');
        new Chart(ctx3, {
            type: 'doughnut',
            data: {
                labels: ['영남권', '중부권'],
                datasets: [{
                    data: [52, 33],
                    backgroundColor: [CHART_COLORS.blue.bg, CHART_COLORS.green.bg],
                    borderColor: [CHART_COLORS.blue.border, CHART_COLORS.green.border],
                    borderWidth: 1,
                    hoverOffset: 4
                }],
                centerNumber: 85,
                centerLabel: "총 협력사"
            },
            options: {
                responsive: true, maintainAspectRatio: false, cutout: '75%',
                plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8, padding: 20 } } }
            },
            plugins: [donutCenterText]
        });

        // 4. 부품별 검사/불량 현황 (그룹 막대 차트 - 이중 Y축 적용)
        const ctx4 = document.getElementById('partDefectGroupedChart').getContext('2d');
        new Chart(ctx4, {
            type: 'bar',
            data: {
                labels: ['내장 부품', '외장 부품'],
                datasets: [
                    {
                        label: '검사 건수 (건)',
                        data: [850, 620],
                        backgroundColor: CHART_COLORS.blue.bg,
                        borderColor: CHART_COLORS.blue.border,
                        borderWidth: 1,
                        borderRadius: 4,
                        barPercentage: 0.6,
                        categoryPercentage: 0.5,
                        yAxisID: 'y' // 왼쪽 축 (단위가 큼)
                    },
                    {
                        label: '불량 건수 (건)',
                        data: [21, 25], // 불량 건수 임의 데이터
                        backgroundColor: CHART_COLORS.red.bg,
                        borderColor: CHART_COLORS.red.border,
                        borderWidth: 1,
                        borderRadius: 4,
                        barPercentage: 0.6,
                        categoryPercentage: 0.5,
                        yAxisID: 'y1' // 오른쪽 축 (단위가 작음)
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 8 } } },
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        type: 'linear', display: true, position: 'left',
                        title: { display: true, text: '검사 건수', font: {size: 11, weight: 'bold'}, color: '#a1a5b7' },
                        grid: gridOptions,
                        suggestedMax: 1000
                    },
                    y1: {
                        type: 'linear', display: true, position: 'right',
                        title: { display: true, text: '불량 건수', font: {size: 11, weight: 'bold'}, color: '#a1a5b7' },
                        grid: { display: false },
                        suggestedMax: 40 // 오른쪽 축 스케일 조정으로 불량 건수 막대가 잘 보이도록 처리
                    }
                }
            }
        });
    </script>
</body>
</html>
